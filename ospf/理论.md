## 内容简介

1. OSPF基础介绍
2. OSPF报文类型
3. OSPF邻居状态机
4. OSPF三张表
5. OSPF-LSA
6. OSPF特殊区域
7. DR和BDR选举过程
8. OSPF接口类型及应用场景
9. OSPF时间状态机
10. OSPF认证参数
11. OSPF收敛协议算法
12. OSPF网络类型
13. LSDB的构成(详细)

### OSPF基础介绍

OSPF全称开放式最短路径优先协议*(Open Shortest Path First)*,是一个**基于链路**的内部网关协议。

在OSPF出现前，网络上广泛使用RIP作为内部网关协议，由于**RIP是基于距离矢量算法**的路由协议，存在着收敛慢、路由环路、可扩展性差等问题，所以逐渐被OSPF取代。

### OSPF报文类型

|  报文名称  |                      报文作用                      |
| :--------: | :------------------------------------------------: |
| Hello报文  |       周期性发送，用来发现和维持OSPF邻居关系       |
|   DD报文   | 描述本地LSDB的摘要信息，用于两台设备进行数据库同步 |
|  LSR报文   |              用于向对方请求所需的LSA               |
|  LSU报文   |     根据DD报文和LSR报文向对方发送其所需要的LSA     |
| LSAck 报文 |              用来对收到的LAS进行确认               |

> 请注意，LSR只有在通信双方都交换DD报文后才会向对方发送LSR报文。
>
> 默认情况下，LSU报文会以周期为1800s动态更新，dead time为3600s
>
> LSU会被网络中的行为进行触发更新

### OSPF邻居状态机

| 状态名称 |                           状态描述                           |
| :------: | :----------------------------------------------------------: |
|   Down   | 邻居会话的初始阶段，表明没有在邻居失效时间间隔内收到来自邻居路由器的hello数据包 |
| Attempt  | 该状态仅发生在NBMA网络中，表明对端在***Dead Time***超时前仍然没有回复Hello报文，此时路由器依然会发送 |
|   Init   |                  收到Hello报文后状态为Init                   |
|  2-way   | 收到Hello报文中含有自己的Router ID，则状态为2-way；如果不需要形成邻接关系则邻居状态机停留在2-way状态 |
| Exstart  |    开始协商主从关系，并确定DD的序列号，此时状态为Exstart     |
| Exchange |     主从关系协商完毕后开始交换DD报文，此时状态为Exchange     |
| Loading  |    DD报文交换完成即为**Exchange done**,此时状态为Loading     |
|   Full   |                 LSR重传为空，此时状态为Full                  |

>Attempt状态是NBMA网络类型的独有状态，其他网络类型是没有的。

### OSPF 三张表

#### 邻居表

在ospf交互链路状态通告之前，两台直连路由器需建立OSPF邻居关系，当一个接口激活OSPF后，该接口周期性的发送hello报文，同时开始侦探hello报文从而发现链路上的OSPF邻居，交换链路信息

#### 链路状态数据库

展示网络中其他路由器的信息，**以LSA的形式**，也显示了全网的拓扑

#### OSPF路由表

因为LSDB中存在着全网的拓扑，那么到达某个目的地的路径可能不止一个，所以我们在OSPF路由表中放置所有路径，然后经过算法筛选出最优路径放置在路由表中。

> 请不要混淆路由器路由表和OSPF路由表

### OSPF-LSA

|          LSA类型          |                             作用                             |
| :-----------------------: | :----------------------------------------------------------: |
|     Router-LSA（T1）      | 所有运行了OSPF的设备都会产生，描述了设备的链路状态和开销，在所属的区域内传播 |
|     Network-LSA（T2）     |      由DR产生，描述本网段的链路状态，在所属的区域内传播      |
| Network-Summary-LSA（T3） | 由ABR产生，描述区域内某个网段的路由，不会给Totally STUB或NSSA区域 |
|  ASBR-Summary-LSA（T4）   | 由ABR产生，描述到ASBR的路由，通告给除了ASBR所在区域的其他相关区域 |
|   AS-external-LSA（T5）   |       由ASBR产生，描述到AS外部的路由，通告到所有的区域       |
|  Opaque LSA（T 9 10 11）  |             用于MPLS TE的链路信息传输--暂时不写              |



